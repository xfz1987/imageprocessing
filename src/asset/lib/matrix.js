define(["lib/fft"],function(r){function a(r,a,t,o){this.row=r||0,this.col=a||0,this.channel=4,this.buffer=o||new ArrayBuffer(r*a*this.channel),this.data=new Uint8ClampedArray(this.buffer),t&&this.data.set(t),this.bytes=1,this.type="CV_RGBA",this.at=function(r,t){return this.data[4*a*r+4*t]},this.setValue=function(r,t,o){var e=4*a*r+4*t;this.data[e]=this.data[e+1]=this.data[e+2]=o,this.data[e+3]=255}}function t(r){for(var a=[],t=256;t--;)a[t]=0;for(var o=0;o<r.row;o++)for(var e=0;e<r.col;e++)a[r.at(o,e)]++;return a}function o(r){for(var t=new a(r.row,r.col),o=t.data,e=r.data,n=r.data.length,f=0;f<n;f+=4)o[f]=o[f+1]=o[f+2]=.299*e[f]+.587*e[f+1]+.114*e[f+2],o[f+3]=255;return t}function e(r){for(var t=new a(r.row,r.col),o=0;o<r.row;o++)for(var e=0;e<r.col;e++)t.setValue(o,e,255-r.at(o,e));return t}function n(r){for(var t=r.row/2,o=r.col/2,e=new a(t,o),n=e.data,f=r.data,l=0,c=0;c<t*o*4;c+=4)c%(4*o)||l++,n[c]=n[c+1]=n[c+2]=f[2*c+l*o*8],n[c+3]=255;return e}function f(r){for(var t=2*r.row,o=2*r.col,e=new a(t,o),n=e.data,f=r.data,l=0,c=0;c<t*o*4;c+=4)c%(4*o)||l++,n[c]=n[c+1]=n[c+2]=f[c/2+l*o*2],n[c+3]=255;return e}function l(r,t){for(var o=new a(r.row,r.col),e=0;e<r.row;e++)for(var n=0;n<r.col;n++)o.setValue(e,n,Math.floor(t*(Math.log(1+r.at(e,n))/Math.log(2))));return o}function c(r){for(var o=new a(r.row,r.col),e=r.data.length/4,n=t(r),f=0;f<256;f++)n[f]=n[f]/e;for(var f=1;f<256;f++)n[f]=n[f]+n[f-1];for(var f=0;f<r.row;f++)for(var l=0;l<r.col;l++)o.setValue(f,l,Math.floor(255*n[r.at(f,l)]));return o}function i(r,t){for(var o=new a(r.row,r.col),e=[[t[0],t[1],t[2]],[t[3],t[4],t[5]],[t[6],t[7],t[8]]],n=0,f=0;f<9;f++)n+=t[f];for(var f=1;f<r.row-1;f++)for(var l=1;l<r.col-1;l++){var c=r.at(f-1,l-1)*e[0][0]+r.at(f-1,l)*e[0][1]+r.at(f-1,l+1)*e[0][2],i=r.at(f,l-1)*e[1][0]+r.at(f,l)*e[1][1]+r.at(f,l+1)*e[1][2],u=r.at(f+1,l-1)*e[2][0]+r.at(f+1,l)*e[2][1]+r.at(f+1,l+1)*e[2][2];o.setValue(f,l,(c+i+u)/n)}return o}function u(r){for(var t=new a(r.row,r.col),o=[[1,1,1],[1,-8,1],[1,1,1]],e=1;e<r.row-1;e++)for(var n=1;n<r.col-1;n++){var f=r.at(e-1,n-1)*o[0][0]+r.at(e-1,n)*o[0][1]+r.at(e-1,n+1)*o[0][2],l=r.at(e,n-1)*o[1][0]+r.at(e,n)*o[1][1]+r.at(e,n+1)*o[1][2],c=r.at(e+1,n-1)*o[2][0]+r.at(e+1,n)*o[2][1]+r.at(e+1,n+1)*o[2][2];t.setValue(e,n,f+l+c)}return t}function w(r,t){for(var o=new a(r.row,r.col),e=u(r),n=0;n<r.row;n++)for(var f=0;f<r.col;f++)o.setValue(n,f,t*r.at(n,f)-e.at(n,f));return o}function v(t){var o=new a(t.row,t.col),e=r.center(t),n=r.fft2D(e,t.col,t.row);return r.scale(o,n),l(o,50)}function h(t,o){for(var e=t.row,n=t.col,f=e*n,l=new a(e,n),c=r.center(t),i=r.fft2D(c,n,e),u=0;u<f;u++){var w=u/n,v=u%n,h=Math.exp(-(Math.pow(w-e/2,2)+Math.pow(v-n/2,2))/(2*o));i[u].real=i[u].real*h,i[u].imaginary=i[u].imaginary*h}for(var s=r.ifft2D(i,n,e),u=0;u<e;u++)for(var d=0;d<n;d++)l.setValue(u,d,s[f-1-(u*n+d)].real*f*Math.pow(-1,u+d));return l}function s(t,o){for(var e=t.row,n=t.col,f=e*n,l=new a(e,n),c=r.center(t),i=r.fft2D(c,n,e),u=0;u<f;u++){var w=u/n,v=u%n,h=1-Math.exp(-(Math.pow(w-e/2,2)+Math.pow(v-n/2,2))/(2*o));i[u].real=i[u].real*h,i[u].imaginary=i[u].imaginary*h}for(var s=r.ifft2D(i,n,e),u=0;u<e;u++)for(var d=0;d<n;d++)l.setValue(u,d,s[f-1-(u*n+d)].real*f*Math.pow(-1,u+d));return l}function d(r,o,e){for(var n,f,l=new a(r.row,r.col),c=(t(r),r.row*r.col,0);c<r.row;c++)for(var i=0;i<r.col;i++)n=Math.random(),f=0,n<o?f=255:n>=o&&n<o+e&&(f=1),l.setValue(c,i,f>0?f:r.at(c,i));return l}function g(r,o,e){for(var n=new a(r.row,r.col),f=(t(r),r.row*r.col,Math.sqrt(e)),l=[],c=0;c<256;c++)l[c]=Math.exp(-Math.pow(c-o,2)/(2*e))/(Math.sqrt(2*Math.PI)*f);for(var i,c=0;c<r.row;c++)for(var u=0;u<r.col;u++)i=Math.random(),n.setValue(c,u,i<l[r.at(c,u)]?255*i:r.at(c,u));return n}function p(r){for(var t=new a(r.row,r.col),o=[],e=function(r,a){return r-a},n=1;n<r.row-1;n++)for(var f=1;f<r.col-1;f++)o=[r.at(n-1,f-1),r.at(n-1,f),r.at(n-1,f+1),r.at(n,f-1),r.at(n,f),r.at(n,f+1),r.at(n+1,f-1),r.at(n+1,f),r.at(n+1,f+1)],o.sort(e),t.setValue(n,f,o[4]);return t}function M(r){for(var t=new a(r.row,r.col),o=[[1,1,1,1,1,1,1],[1,1,1,1,1,1,1],[1,1,1,1,1,1,1],[1,1,1,1,1,1,1],[1,1,1,1,1,1,1],[1,1,1,1,1,1,1],[1,1,1,1,1,1,1]],e=o.length,n=(e-1)/2,f=function(r,a){return r-a},l=n;l<r.row-n;l++)for(var c=n;c<r.col-n;c++){for(var i=[],u=0;u<e;u++)for(var w=0;w<e;w++)i.push(r.at(l-n+u,c-n+w)*o[u][w]);i.sort(f),t.setValue(l,c,i[i.length-1])}return t}function m(r,t){for(var o=new a(r.row,r.col),e=[[1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1]],n=e.length,f=(n-1)/2,l=f;l<r.row-f;l++)for(var c=f;c<r.col-f;c++){for(var i=0,u=0;u<n;u++)for(var w=0;w<n;w++)i+=r.at(l-f+u,c-f+w)*e[u][w];o.setValue(l,c,i/(n*n))}return o}function V(r,t){for(var o=new a(r.row,r.col),e=[[1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1]],n=e.length,f=(n-1)/2,l=f;l<r.row-f;l++)for(var c=f;c<r.col-f;c++){for(var i=0,u=0;u<n;u++)for(var w=0;w<n;w++)i+=1/(r.at(l-f+u,c-f+w)*e[u][w]);o.setValue(l,c,n*n/i)}return o}function y(r,t,o){for(var e=new a(r.row,r.col),n=[[1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1]],f=n.length,l=(f-1)/2,c=l;c<r.row-l;c++)for(var i=l;i<r.col-l;i++){for(var u=0,w=0,v=0;v<f;v++)for(var h=0;h<f;h++){var s=r.at(c-l+v,i-l+h)*n[v][h];u+=Math.pow(s,o+1),w+=Math.pow(s,o)}e.setValue(c,i,u/w)}return e}function D(r){for(var t=new a(r.row,r.col),o=r.data,e=t.data,n=0;n<o.length;n+=4)o[n]<10?(e[n]=e[n+1]=255,e[n+2]=0,e[n+3]=255):(e[n]=e[n+1]=e[n+2]=o[n],e[n+3]=255);return t}function F(r){for(var t=new a(r.row,r.col),o=r.data.length/4,e=[],n=[],f=[],l=256;l--;)e[l]=n[l]=f[l]=0;for(var c=r.data,i=t.data,u=0;u<c.length;u+=4)e[c[u]]++,n[c[u+1]]++,f[c[u+2]]++;for(var u=0;u<256;u++)e[u]=e[u]/o,n[u]=n[u]/o,f[u]=f[u]/o;for(var u=1;u<256;u++)e[u]=e[u]+e[u-1],n[u]=n[u]+n[u-1],f[u]=f[u]+f[u-1];for(var u=0;u<c.length;u+=4)i[u]=Math.floor(255*e[c[u]]),i[u+1]=Math.floor(255*n[c[u+1]]),i[u+2]=Math.floor(255*f[c[u+2]]),i[u+3]=255;return t}return a.prototype={getHistogram:t,gray:o,reverseColor:e,scaleDown:n,scaleUp:f,log:l,histogram:c,spatialFilter:i,laplacian:u,unsharp:w,fourier:v,glpfilter:h,ghpfilter:s,sapNoise:d,gsNoise:g,medianFilter:p,maximumFilter:M,ArithmeticMeanFilter:m,harmonicFilter:V,iharmonicFilter:y,pseudoColor:D,colorImgHE:F},a});